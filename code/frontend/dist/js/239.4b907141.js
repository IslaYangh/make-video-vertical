"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[239],{627:function(e,i,t){t.d(i,{jr:function(){return l},uC:function(){return n},a2:function(){return s},rR:function(){return o},dS:function(){return r}});var a=t(1374);const l=e=>a.Z.get("/api/file/page",{params:e}),n=e=>a.Z["delete"]("/api/file/"+e),s=e=>a.Z.post("/api/file/upload",e,{headers:{"Content-Type":"multipart/form-data"}}),o=e=>a.Z.post("/video-api/processVideo",e,{hideMessage:!0}),r=e=>a.Z.put("/api/file/setResult",e)},5239:function(e,i,t){t.r(i),t.d(i,{default:function(){return we}});var a=t(3396),l=t(4870),n=t(7139),s=t(4239);const o={class:"video-player-container"},r={class:"video"},d=["src"],u=(0,a._)("div",{class:"mask"},null,-1),c=(0,a._)("div",{class:"box"},null,-1),v=(0,a._)("div",{class:"mask"},null,-1),f={class:"button-container"},m={class:"play"},p={class:"current-time"},h={class:"total-time"};var w={props:{showMask:{type:Boolean,default:!1}},setup(e){const i=(0,a.f3)(s.Z.currentVideoUrl),t=(0,l.iH)(!1);(0,a.YP)((()=>t.value),(()=>{const e=w.value;t.value?(e.currentTime===e.duration&&(e.currentTime=0),e.play()):e.pause()}));const w=(0,l.iH)(null),g=(0,l.iH)(null),_=(0,l.iH)(null),y=(0,l.iH)(null),k=(0,l.iH)(0),Z=(0,l.iH)(0),S=e=>{k.value=e.target.duration},b=e=>{const i=Math.floor(e/3600),t=Math.floor(e%3600/60),a=Math.floor(e%60),l=i.toString().padStart(2,"0"),n=t.toString().padStart(2,"0"),s=a.toString().padStart(2,"0");return`${l}:${n}:${s}`},U=(0,l.iH)(!1),x=()=>{const e=w.value,i=_.value,t=y.value;Z.value=e.currentTime;const a=e.currentTime/e.duration*100;i.style.width=`${a}%`,t.style.left=`${a}%`},H=()=>{U.value=!0;const e=g.value,i=w.value,t=t=>{const a=e.getBoundingClientRect(),l=t.clientX-a.left,n=l/a.width*100;i.currentTime=n/100*i.duration,x()},a=()=>{U.value=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",a)};return(s,U)=>((0,a.wg)(),(0,a.iD)("div",o,[(0,a._)("div",r,[(0,a._)("video",{ref_key:"videoRef",ref:w,src:(0,l.SU)(i)?(0,l.SU)(i):null,onTimeupdate:x,onLoadedmetadata:S,onEnded:U[0]||(U[0]=e=>t.value=!1)},null,40,d),e.showMask?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[u,c,v],64)):(0,a.kq)("",!0)]),(0,a._)("div",f,[(0,a._)("div",m,[t.value?((0,a.wg)(),(0,a.iD)("i",{key:0,class:"iconfont icon-24gf-pause2",onClick:U[1]||(U[1]=e=>t.value=!1)})):((0,a.wg)(),(0,a.iD)("i",{key:1,class:"iconfont icon-bofang",onClick:U[2]||(U[2]=e=>t.value=!0)}))]),(0,a._)("span",p,(0,n.zw)(b(Z.value)),1),(0,a._)("span",h,(0,n.zw)(b(k.value)),1),(0,a._)("div",{class:"progress",ref_key:"progressBarRef",ref:g,onMousedown:H},[(0,a._)("div",{class:"line",ref_key:"progressLineRef",ref:_},null,512),(0,a._)("div",{class:"point",ref_key:"progressIndicatorRef",ref:y},null,512)],544)])]))}};const g=w;var _=g,y=t(9726),k={props:{width:Number,frame:Number,showNumber:Boolean},setup(e){const i=e,t=(0,a.Fl)((()=>i.showNumber?5:3)),s=(0,a.Fl)((()=>y.Z.frame2Time(i.frame?i.frame:0,30)));return(i,o)=>((0,a.wg)(),(0,a.iD)("div",{style:(0,n.j5)([{position:"relative","flex-shrink":"0"},{width:e.width+"px",height:"22px"}])},[(0,a._)("div",{class:"grid-container",style:(0,n.j5)({width:e.width+"px",height:(0,l.SU)(t)+"px"})},null,4),e.showNumber?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"grid-number",style:(0,n.j5)({marginTop:(0,l.SU)(t)+2+"px"})},(0,n.zw)((0,l.SU)(s)),5)):(0,a.kq)("",!0)],4))}};const Z=k;var S=Z;const b=e=>((0,a.dD)("data-v-6fcc4fd5"),e=e(),(0,a.Cn)(),e),U=b((()=>(0,a._)("div",{class:"placeholder"},null,-1)));var x={props:{visionTrackMaterial:Object,frames:Array},setup(e){const i=e,t=(0,a.f3)(s.Z.frameWidth),o=(0,l.iH)({image:"",position:""}),r=s.Z.VIDEO_FRAME_HEIGHT;(0,a.m0)((()=>{if(i.frames){const e=[],t=[];for(let a=0;a<i.frames.length;a++){const l=i.frames[a],n=l.blobUrl,s=l.position,o=n?`url(${n})`:"linear-gradient(#181818, #181818)";e.push(o),t.push(s)}o.value={image:e.join(","),position:t.join(",")}}})),(0,a.Yq)((e=>{}));const d=(0,a.Fl)((()=>i.visionTrackMaterial?y.Z.getMaterialWidth(i.visionTrackMaterial.timelineIn,i.visionTrackMaterial.timelineOut,t.value):0));return(e,i)=>((0,a.wg)(),(0,a.iD)("div",{class:"video-item",style:(0,n.j5)({width:(0,l.SU)(d)+"px"})},[(0,a._)("div",{class:"video-frame",style:(0,n.j5)({backgroundImage:o.value.image,backgroundPosition:o.value.position,height:(0,l.SU)(r)+"px"})},null,4),U],4))}},H=t(89);const M=(0,H.Z)(x,[["__scopeId","data-v-6fcc4fd5"]]);var L=M,D=t(849);const T={class:"top-operation-area"},j=(0,a._)("div",null,null,-1),C=(0,a._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10.553",height:"10.524",viewBox:"0 0 10.553 10.524"},[(0,a._)("path",{id:"路径_1558","data-name":"路径 1558",d:"M137.633,135.634H133.27v-4.38a.44.44,0,1,0-.88,0v4.377l-4.431,0h0a.44.44,0,0,0,0,.88l4.434,0V140.9a.44.44,0,1,0,.88,0v-4.384h4.361a.44.44,0,0,0,0-.88Z",transform:"translate(-127.518 -130.816)",fill:"#fff"})],-1),F=[C],W=(0,a._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10.553",height:"0.885",viewBox:"0 0 10.553 0.885"},[(0,a._)("path",{id:"路径_1559","data-name":"路径 1559",d:"M137.633,135.634H133.27v-.006c.008.008-.2.006-.44.006l-.44-.006v0l-4.431,0h0a.44.44,0,0,0,0,.88l4.434,0v0c.019,0,.2,0,.44,0s.464.006.44,0v.006h4.361a.44.44,0,0,0,0-.88Z",transform:"translate(-127.518 -135.63)",fill:"#fff"})],-1),E=[W],I=(0,a._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10.583",height:"10.524",viewBox:"0 0 10.583 10.524"},[(0,a._)("path",{id:"路径_1560","data-name":"路径 1560",d:"M5.217,6.019c0-.288-.229-.4-.506-.4H.756a.409.409,0,1,0,0,.817H3.83L.443,9.814A.391.391,0,0,0,1,10.367l3.412-3.4v3.111a.41.41,0,1,0,.82,0V6.019m5.256-2.005H7.41L10.8.639a.391.391,0,1,0-.555-.553l-3.4,3.4V.375a.41.41,0,1,0-.82,0V4.41c0,.012.012.012.012.024a.429.429,0,0,0,.109.288.364.364,0,0,0,.374.1h3.954a.406.406,0,0,0,.41-.408.4.4,0,0,0-.4-.4Z",transform:"translate(-0.329 0.035)",fill:"#fff"})],-1),z=[I],R={style:{width:"100%",height:"calc(100% - 31px)",display:"flex","flex-direction":"row"}},V=(0,a._)("div",{class:"left-operation-area",style:{width:"37px"}},null,-1);var Y={setup(e){const i=(0,a.f3)(s.Z.coreData),t=(0,a.Fl)((()=>y.Z.getVideoTrackMaterialList(i.sections[g.value-1].sectionTimeline.visionTrack.visionTrackMaterials))),o=(0,a.f3)(s.Z.frameWidth),r=(0,l.iH)(null),d=(0,l.iH)([]),u=(0,a.f3)(s.Z.timeLineContainer_width),c=(0,a.f3)(s.Z.timeLineOffsetLeft),v=(0,a.f3)(s.Z.timeLine_width),f=(0,a.f3)(s.Z.timescale_width),m=(0,a.f3)(s.Z.timescale_placeholder_width),p=(0,a.f3)(s.Z.gridWidth),h=(0,a.f3)(s.Z.gridFrame),w=(0,a.f3)(s.Z.groupGridFrame),g=(0,a.f3)(s.Z.currentSectionIndex),_=(0,a.f3)(s.Z.minFrameWidth),k=(0,a.f3)(s.Z.maxFrameWidth),Z=(0,a.f3)(s.Z.fitFrameWidth),b=(0,a.f3)(s.Z.maxFrameOfMaterial),U=(0,a.f3)(s.Z.framesMap),x=((0,a.f3)(s.Z.videoFrameList),()=>{D.i6.zoomIn(o,k)}),H=()=>{D.i6.zoomOut(o,_)},M=()=>{D.i6.zoomFit(o,Z)};return(0,a.m0)((()=>{y.Z.renderGridBufferList(d,p.value,w.value,h.value,c.value,v.value)})),(0,a.bv)((()=>{r.value?r.value.addEventListener("scroll",(e=>{e.target&&e.target.scrollLeft<=f.value-v.value&&(c.value=e.target.scrollLeft)})):console.log("error: timeLine.value is",r.value)})),(e,i)=>((0,a.wg)(),(0,a.iD)("div",{class:"timeline-container",style:(0,n.j5)({width:(0,l.SU)(u)+"px"})},[(0,a._)("section",T,[j,(0,a._)("div",null,[(0,a._)("div",{class:"top-button-right",onClick:x,style:(0,n.j5)({pointerEvents:0===(0,l.SU)(b)||(0,l.SU)(o)===(0,l.SU)(k)?"none":"auto",opacity:0===(0,l.SU)(b)||(0,l.SU)(o)===(0,l.SU)(k)?.2:1})},F,4),(0,a._)("div",{class:"top-button-right",onClick:H,style:(0,n.j5)({pointerEvents:0===(0,l.SU)(b)||(0,l.SU)(o)===(0,l.SU)(_)?"none":"auto",opacity:0===(0,l.SU)(b)||(0,l.SU)(o)===(0,l.SU)(_)?.2:1})},E,4),(0,a._)("div",{class:"top-button-right",onClick:M,style:(0,n.j5)({pointerEvents:0===(0,l.SU)(b)?"none":"auto",opacity:0===(0,l.SU)(b)?.5:1})},z,4)])]),(0,a._)("section",R,[V,(0,a._)("div",{class:"timeline",style:(0,n.j5)({width:(0,l.SU)(v)+"px"}),ref_key:"timeLine",ref:r},[(0,a._)("div",{class:"timescale",style:(0,n.j5)({width:(0,l.SU)(f)+"px"})},[(0,a._)("div",{style:(0,n.j5)([{"flex-shrink":"0"},{width:(0,l.SU)(m)+"px"}])},null,4),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.value,(e=>((0,a.wg)(),(0,a.j4)(S,{key:e,frame:e.frame,width:e.width,showNumber:e.showNumber},null,8,["frame","width","showNumber"])))),128))],4),(0,a._)("div",{class:"video-line",style:(0,n.j5)({width:(0,l.SU)(f)+"px"})},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)((0,l.SU)(t),((e,i)=>((0,a.wg)(),(0,a.j4)(L,{key:e,visionTrackMaterial:e,frames:(0,l.SU)(U).get(i)},null,8,["visionTrackMaterial","frames"])))),128))],4)],4)])],4))}};const N=Y;var B=N,O=t(7601),P=t(627),$=t(5743),q=t.n($);const A={class:"page-video"},G={class:"video-editor-container left"},K={key:1,class:"upload"},Q=(0,a._)("div",{class:"icon"},"+",-1),X=(0,a._)("div",{class:"title"},"导入视频",-1),J=(0,a._)("div",{class:"tip"},"导入视频后自动保存到素材库",-1),ee={class:"right"},ie={key:0,class:"video-info"},te={class:"item"},ae=(0,a._)("div",{class:"label"},"名称:",-1),le={class:"value"},ne={class:"item"},se=(0,a._)("div",{class:"label"},"导入时间:",-1),oe={class:"value"},re={key:1,class:"video-info"},de=["src"],ue=(0,a._)("div",{class:"size"},null,-1),ce=(0,a._)("div",{class:"info"},"9:16",-1),ve=[ue,ce],fe={class:"action"},me=(0,a.Uk)(" 导出 ");var pe={setup(e){const i=(0,a.f3)(s.Z.coreData),t=(0,a.f3)(s.Z.timeLineContainer_width),o=(0,a.f3)(s.Z.frameWidth),r=(0,a.f3)(s.Z.currentVideoUrl),d=(0,a.f3)(s.Z.fitFrameWidth),u=(0,a.f3)(s.Z.currentSectionIndex),c=(0,l.iH)(null),v=(0,a.f3)(s.Z.currentFile),f=(0,l.iH)({}),m=(0,O.PR)(),p=(0,l.iH)(!1),h=e=>{D.dt.addVideoOnCurrentSection(e.target.files,r,i,o,d,u,c),v.value=e.target.files[0];const t=new FormData;t.append("file",e.target.files[0]),t.append("userId",m.id),p.value=!0,(0,P.a2)(t).then((e=>{f.value=e.data})).finally((()=>{p.value=!1}))};t.value=y.Z.calcTimeLineContainerWidth(document.body.clientWidth),window.onresize=()=>(()=>{t.value=y.Z.calcTimeLineContainerWidth(document.body.clientWidth)})();const w=(0,l.iH)(""),g=(0,l.iH)(!1),k=()=>{p.value=!0,(0,P.rR)({path:f.value.absolutePath,fileId:f.value.id}).then((e=>{w.value="/video-api"+e.data,(0,P.dS)({id:f.value.id,resultPath:e.data})})).finally((()=>{p.value=!1}))},Z=()=>{g.value=!g.value,w.value||k()},S=()=>{window.open(w.value)};return(0,a.Ah)((()=>{v.value=null})),(e,i)=>{const t=(0,a.up)("el-button"),s=(0,a.Q2)("loading");return(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",A,[(0,a._)("div",G,[(0,l.SU)(v)?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Wm)(_,{"show-mask":g.value},null,8,["show-mask"]),(0,a.Wm)(B)],64)):((0,a.wg)(),(0,a.iD)("div",K,[Q,X,J,(0,a._)("input",{type:"file",style:{width:"100%",height:"100%",opacity:"0",position:"absolute"},multiple:"",ref_key:"videoInputElement",ref:c,onChange:i[0]||(i[0]=e=>h(e)),accept:"video/*"},null,544)]))]),(0,a._)("div",ee,[Object.keys(f.value).length?((0,a.wg)(),(0,a.iD)("div",ie,[(0,a._)("div",te,[ae,(0,a._)("div",le,(0,n.zw)(f.value.fileName),1)]),(0,a._)("div",ne,[se,(0,a._)("div",oe,(0,n.zw)((0,l.SU)(q())(f.value.createAt).format("YYYY-MM-DD HH:mm:ss")),1)])])):(0,a.kq)("",!0),w.value?((0,a.wg)(),(0,a.iD)("div",re,[(0,a._)("video",{src:w.value,controls:""},null,8,de)])):(0,a.kq)("",!0),(0,a._)("div",{class:(0,n.C_)(["box",{select:g.value}]),onClick:Z},ve,2),(0,a._)("div",fe,[(0,a.Wm)(t,{type:"primary",disabled:!f.value.absolutePath||!g.value||!w.value,onClick:S},{default:(0,a.w5)((()=>[me])),_:1},8,["disabled"])])])])),[[s,p.value]])}}};const he=pe;var we=he}}]);
//# sourceMappingURL=239.4b907141.js.map